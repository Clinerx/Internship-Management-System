{% extends 'organization_pages/organization_base.html' %}
{% block title %}Organizations Internships{% endblock %}

{% block content %}


<!-- Button to open the modal -->


<!-- Modal Structure -->
<div id="postingModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-content">
        <span class="close" aria-label="Close modal">&times;</span>
        <h2 id="modalTitle">Posting Internship</h2>
        <form class="internship-form" method="POST">
            {% csrf_token %}
            <div class="form-column">
                <div class="form-group" >
                    <label for="internshipTitle">{{ form.title.label_tag }}</label>
                    {{ form.title }}
                </div>
                <div class="form-group">
                    <label for="organizationName">{{ form.organization_name.label_tag }}</label>
                    {{ form.organization_name }}
                </div>
            </div>

            <div class="form-column">
                <div class="form-group">
                    <label for="location">{{ form.location.label_tag }}</label>
                    {{ form.location }}
                </div>
                <div class="form-group">
                    <label for="description">{{ form.description.label_tag }}</label>
                    {{ form.description }}
                </div>
            </div>

            <div class="form-column">
                <div class="form-group">
                    <label for="requirements">{{ form.requirements.label_tag }}</label>
                    {{ form.requirements }}
                </div>
                <div class="form-group">
                    <label for="applicationProcess">{{ form.application_process.label_tag }}</label>
                    {{ form.application_process }}
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="requiredSkill">{{ form.required_skills.label_tag }}</label>
                    {{ form.required_skills }}
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="desiredExperience">{{ form.desired_experience.label_tag }}</label>
                    {{ form.desired_experience }}
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="maxApplicants">{{ form.max_applicants.label_tag }}</label>
                    {{ form.max_applicants }}
                </div>
            </div>
            
            <div class="form-button">
                <button type="submit" class="btn btn-primary">Submit Posting</button>
            </div>
        </form>
    </div>
</div>

 <!-- Pagination controls -->
 

<hr>

<section class="internship-postings-section">
    <h2>Posted Internships</h2>
    <div class="btn_page_create">
        <button id="openModalBtn" class="btn btn-primary">Create Internship</button>
        <div class="pagination">
            <span class="step-links">
                {% if internships.has_previous %}
                    <a href="?page=1">&laquo; First</a>
                    <a href="?page={{ internships.previous_page_number }}">Previous</a>
                {% endif %}
        
                <span class="current">
                    Page {{ internships.number }} of {{ internships.paginator.num_pages }}
                </span>
        
                {% if internships.has_next %}
                    <a href="?page={{ internships.next_page_number }}">Next</a>
                    <a href="?page={{ internships.paginator.num_pages }}">Last &raquo;</a>
                {% endif %}
            </span>
        </div>
    </div>
    
    <div class="table-responsive posting-section">
        <table class="table table-bordered internship-table">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Organization</th>
                    <th>Internship Title</th>
                    <th>Location</th>
                    <th>Available Applicants</th>
                    <th>Posted Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for internship in internships %}
                    <tr>
                        <td>{{ start_number|add:forloop.counter }}</td>

                        <!-- Organization Picture and Name -->
                        <td class="organizationProfile">
                            <div class="org_image_name">
                                <p>{{ internship.organization.company_name }}</p>
                            </div>
                        </td>

                        <!-- Internship Details -->
                        <td>{{ internship.title }}</td>
                        <td>{{ internship.location }}</td>
                        <th>{{ internship.max_applicants}}</th>
                        <td>{{ internship.created_at|date:"F d, Y" }}</td>

                        <!-- Edit and Delete Buttons -->
                        <td class="internship-buttons">
                            <a href="{% url 'view_internship' internship.id %}" class="btn btn-info">View</a>
                            <a href="{% url 'edit_internship' internship.id %}" class="btn btn-primary">Edit</a>
                            <button class="btn btn-danger open-delete-modal" data-id="{{ internship.id }}" data-title="{{ internship.title }}">Delete</button>
                        </td>
                        
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">No internships available at this time.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>


        <!-- Notification Container -->
    <div id="notification" class="alert alert-success" role="alert" aria-live="assertive" style="display: none;">
        <div class="notification-icon">
            <i class="bx bx-check-circle"></i>
        </div>
        <div class="notification-message">
                Internship Posted Successfully!
        </div>
    </div>




</section>

<style>
    .internship-postings-section{
        padding: 130px 100px;
    }
    .internship-postings-section h2{
        text-align: center;
    }
    .btn_page_create{
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    /* General Modal Styling */
    .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: #ffffff;
        padding: 20px;
        margin-top: 95%;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        max-width: 600px;
        width: 90%;
        animation: fadeIn 0.3s ease-in-out;
    }

    .modal-content h2 {
        font-size: 1.5rem;
        color: #333333;
        margin-bottom: 20px;
        text-align: center;
    }

    .modal-content .close {
        color: #666666;
        font-size: 1.5rem;
        font-weight: bold;
        position: absolute;
        right: 15px;
        top: 15px;
        cursor: pointer;
        transition: color 0.3s;
    }

    .modal-content .close:hover {
        color: #ff5e57;
    }

    /* Form Styling */
    .internship-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .internship-form .form-column {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 15px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        width: 100%;  /* Ensure the group takes the full width */
    }

    .form-group label { 
        font-size: 1rem;
        font-weight: bold;
        color: #555555;
        margin-bottom: 5px;
    }

    .form-column .form-group .form-input{
        width: 100%;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
        padding: 10px;
        border: 1px solid #0d213f;
        border-radius: 5px;
        font-size: 1rem;
        transition: border-color 0.3s ease-in-out;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
        border-color: #007bff;
        outline: none;
    }

    .form-button button {
        background-color: #007bff;
        color: #ffffff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s ease-in-out;
    }

    .form-button button:hover {
        background-color: #0056b3;
    }

    /* Table Styling */
    /* General Table Styling */
    .table-responsive {
        overflow-x: auto;
        margin-top: 20px;
        border: 1px solid #dddddd;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background-color: #ffffff;
        padding: 15px;
    }

    /* Table Structure */
    .table {
        width: 100%;
        border-collapse: collapse;
        font-size: 1rem;
        color: #333333;
        text-align: left;
    }

    .table thead {
        background-color: #007bff;
        color: #ffffff;
        text-transform: uppercase;
        font-size: 0.9rem;
        font-weight: bold;
    }

    .table th,
    .table td {
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid #eeeeee;
    }

    .table tbody tr {
        transition: background-color 0.3s ease-in-out;
    }

    .table tbody tr:hover {
        background-color: #f9f9f9;
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
        /* Modal */
        .btn-info{
            padding-inline: 50px;
            margin-bottom: 5px;

        }
        .internship-postings-section{
            padding: 0;
            margin-top: 100px;
        }
        
        .modal-content {
            margin-top: 0;
            width: 95%;
            max-width: 100%;
        }

        /* Internship Table */
        .table-responsive {
            padding: 10px;
        }

        .table th,
        .table td {
            font-size: 0.9rem;
            padding: 10px;
        }

        .btn_page_create {
            display: block;
            width: 100%;
            margin-bottom: 10px;
        }

        /* Form Columns */
        .internship-form .form-column {
            flex-direction: column;
            gap: 10px;
        }

        .form-group {
            width: 100%;
        }

        .form-button button {
            width: 100%;
        }
    }

    @media (max-width: 480px) {
        /* Header Font Size */
        internship-buttons a{
            padding-inline: 100%;

        }
        .internship-postings-section h2{
            text-align: center;
            font-size: 1.5rem;
        }
        .btn_page_create{
            padding-inline: 10px;
            display: flex;
            gap: 15px;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }
        .modal-content h2 {
            font-size: 1.25rem;
        }

        .form-group label {
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            font-size: 0.9rem;
            padding: 8px;
        }

        .table th,
        .table td {
            font-size: 0.85rem;
        }

        .form-button button {
            padding: 8px 15px;
        }
    }
/* Delete Confirmation Modal */
#deleteModal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}

#deleteModal .modal-content {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    text-align: center;
}

#deleteModal .modal-content p {
    margin: 20px 0;
    color: #555555;
}

/* Pagination Styling */
.pagination .step-links a {
    text-decoration: none;
    padding: 8px 12px;
    margin: 0 5px;
    border: 1px solid #007bff;
    color: #007bff;
    border-radius: 5px;
    transition: all 0.3s;
}

.pagination .step-links a:hover {
    background-color: #007bff;
    color: #ffffff;
}

.pagination .step-links .current {
    padding: 8px 12px;
    margin: 0 5px;
    color: #ffffff;
    background-color: #007bff;
    border-radius: 5px;
}

/* Animations */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes slideDown {
    from {
        transform: translateY(-20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}


</style>
<!-- Styles for Modal -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var modal = document.getElementById("postingModal");
        var openModalBtn = document.getElementById("openModalBtn");
        var closeModalBtn = document.querySelector(".close");

        // Open the modal when the button is clicked
        openModalBtn.onclick = function () {
            modal.style.display = "flex";
            modal.setAttribute("aria-hidden", "false");
        };

        // Close the modal when the 'X' button is clicked
        closeModalBtn.onclick = function () {
            modal.style.display = "none";
            modal.setAttribute("aria-hidden", "true");
        };

        // Close the modal if user clicks outside of the modal content
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
                modal.setAttribute("aria-hidden", "true");
            }
        };

        // Show the notification if the internship was posted
        {% if internship_posted %}
            var notification = document.getElementById('notification');
            notification.style.display = 'flex';  // Make notification visible
            setTimeout(function() {
                notification.classList.add('show');  // Trigger slide-in animation
            }, 100); // Delay to ensure it's visible before animating

            // Hide the notification after 3 seconds
            setTimeout(function() {
                notification.classList.remove('show');  // Slide it out
                setTimeout(function() {
                    notification.style.display = 'none';  // Fully hide after sliding out
                }, 500); // Wait for the slide-out animation to complete
            }, 5000);  // Keep it visible for 3 seconds
        {% endif %}
    });


    document.addEventListener('DOMContentLoaded', function () {
        // Posting modal logic (same as before)
        
        // Delete modal logic
        var deleteModal = document.getElementById("deleteModal");
        var openDeleteModalBtns = document.querySelectorAll(".open-delete-modal");
        var closeDeleteModalBtns = document.querySelectorAll(".close, .close-delete-modal");
        var internshipTitleToDelete = document.getElementById("internshipTitleToDelete");
        var deleteForm = document.getElementById("deleteForm");

        openDeleteModalBtns.forEach(function (btn) {
            btn.addEventListener('click', function () {
                var internshipId = this.getAttribute('data-id');
                var internshipTitle = this.getAttribute('data-title');
                internshipTitleToDelete.textContent = `"${internshipTitle}"`;  // Update the modal content
                deleteForm.action = `/delete_internship/${internshipId}/`;  // Set the form action dynamically
                deleteModal.style.display = "flex";  // Show the modal
            });
        });

        closeDeleteModalBtns.forEach(function (btn) {
            btn.addEventListener('click', function () {
                deleteModal.style.display = "none";  // Hide the modal
            });
        });

        // Close modal if clicking outside of the modal content
        window.onclick = function (event) {
            if (event.target == deleteModal) {
                deleteModal.style.display = "none";
            }
        };
    });



    
</script>

{% endblock content %}
